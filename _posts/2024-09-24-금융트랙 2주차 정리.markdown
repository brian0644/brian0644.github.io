---
layout: post
title:  "금융트랙 2주차 정리"
date:   2024-09-24 14:01+09:00
categories: khuda finance track
---
# 지도학습: 회귀(시계열 모델)
* 회귀 기반 지도 학습은 예측 모델로, 목표와 예측 변수간의 관계를 모델링하고 가능한 연속적 출력값을 예측하는 것 -> 금융에서 가장 많이 사용하는 머신러닝
* 자산 가격, 자산 수익 예측과 같은 투자 기회 <- 예측 변수의 속성, 다른 변수와의 관계를 이해하고 자산 수익을 견인하는 **중요한 요소**를 찾는것
* 뿐만 아니라 포트폴리오 관리, 보험 가격 책정, 상품 가격 책정, 헤징, 위험 관리 등 광범위한 재무 영역에 적용

## 사용되는 모델
* 시계열 모델 : 과거에 일련의 데이터에서 무슨 일이 발생했는지 추론하고 앞으로 무슨 일이 발생할지 예측 하는 것
  * 고정성(추세나 계절성을 갖지 않는 것)을 없애고 자기상관을 반영하고자 AR(자기상관)I(차분)MA(이동평균)모델을 주로 사용함
  * ARIMA 뿐만 아니라 ARIMAX(외생 변수가 포함되는, 시간 + a), SARIMA(계절성 요소를 모델링 하는 것이 목표), VARMA(다변수 확장-> 동시에 여러 변수 예측)을 사용하기도 함
  * 시계열과 딥러닝은 밀접한 연관이 있는데 LSTM(장단기 메모리)를 사용하면 예전의 시계열 정보들도 컴퓨터가 기억할 수 있게 함으로써 시계열 데이터를 딥러닝과 접목할 수 있게 만듬


* 지도 회귀 모델 : 앞서 언급한대로 독립변수를 토대로 예측(아마두 주가나 수익률 같은 수익과 관련된)하는 것
  * 지도 학습 모델을 사용하기 위해서는 우선 시계열 데이터를 시간에 따른 값의 변화 -> 이전 시간 단계의 값을 입력으로 사용해 다음 시간 단계의 값을 예측하는 식으로 재구성 해야함
    
<img width="197" alt="스크린샷 2024-09-24 오후 2 18 08" src="https://github.com/user-attachments/assets/1e656186-5b32-422c-b7fe-b9808b98ee13">

  * 이는 판다스에서 제공하는 shift()함수를 사용하면 변환 가능

## 금융 산업과 모델 활용 사례
### 주가 예측 
* 마이크로소프트 주가를 종속변수로, 독립변수로 IBM과 구글의 주가, 환율(미국 달러, 엔화 및 파운드), 인덱스를 포함하였다
* 각 회사의 주가는 5일 지연, 15일 지연, 30일 지연, 60일 지연 수익을 사용함으로써 해당 기간 별 수익률을 비교 할 수 있도록 분리

1. EDA 진행<br>
   dataset.head()를 통해 기술통계량을, pyplpot에 corr()를 넣어서 각 독립변수간, 혹은 종속변수와의 상관관계를 살펴보았다 -> 다중공선성은 성능을 방해할 수 있으니 -> 당연하게도 기간별 지연 수익의 상관관계 있었음
  
2. 시계열 분석<br>
    관측치, 추세, 계절성, 잔여요소로 구별됨 -> 추세를 보고 최근 주가가 어떤 경향을 보이는지 분석 가능
   
3. 머신러닝 모델 훈련 및 평가<br>
    일단 훈련세트는 80, 테스트셋 20으로 slit. k=10, MSE로 kfold를 통한 교차 검증 옵션 세팅
    <br>
    모델은 선형회귀, 라쏘, 엘라스틱넷(릿&라), KNN, 의사결정나무, SVM, 신경망 알고리즘, adaboost, gradientboosting(얘네 둘이가 부스팅 방법), 랜포, extratree(배깅 방법)을 모두를 사용하여 훈련
   -> 라쏘, 엘라스틱 넷을 포함한 선형 회귀와 정규화 회귀 모델이 가장 성능이 좋았음 -> 종속변수와 독립 변수 간에 강한 상관관계 유의
   -> 의사결정 나무는 과적합하고 테스트셋과 오차 존재 // GBR&RFR은 편향은 낮지만 분산이 높았음 // MLP는 부적당한 하이퍼 파라미터, 불충분한 모델 훈련으로 인해 변수간의 선형 관계를 찾지 못해서 성능 낮았음
  
4. 시계열 기반 모델 훈련 및 평가<br>
    머신러닝 모델 훈련에서는 지연 특성을 따로 정의하여 시간 지연 접근방법을 사용하였지만, 시계열 기반 모델에서는 독립변수로 마이크로소프트 주가의 지연 변수를 포함할 필요가 없음 -> 시계열이니깐,,,
   'GOOGL', 'IBM', 'DEXJPUS', 'SP500', 'DJIA', 'VIXCLS'를 외생변수로 사용, 모델은 ARIMA 모델과 LSTM모델을 사용하였다.
   -> 라쏘, 엘라스틱 넷과 비슷한 성능이 나왔으며, 이는 선형 관계가 강하기 때문.
   -> ARIMA의 자귀 회귀의 차수, 차분 정도, 이동 평균 차수는 그리드 탐색(반복문 메커니즘)으로 최적의 하이퍼파라미터를 찾을 수 있다
  
5. 모델 확정 및 테스트셋 결과 분석<br>
    모델은 ARIMA(2,0,1)으로 선택, 실제 데이터와 예측 데이터 그래프를 시각화 해보니 모델이 추세를 완벽하게 완벽하게 찾아냄을 알 수 있었다. 예측 시계열이 실제 시계열보다 변동성이 낮고, 테스트셋의 처음 수개월동안 실제 데이터와 일치했다.
   모델의 목적은 현시점까지 관측된 데이터가 주어졌을 때 다음날의 수익을 계산하는 것이지 **미래 며칠 후의 주가를 예측하는 것이 아니다**
  
   
### 파생상품 가격 책정 
* 전산 재무 및 위험 관리에서는 금융 파생상품을 평가할 때 유한 차이, 푸리에 방법, 몬테카를로 시뮬레이션, **블랙-숄즈 공식**(기하 브라운 운동을 한다는 가정)을 사용
* 기하 브라운 운동을 한다는 가정 그리고 옵션 만기 시 조건부 지급, 차익 금지와 같은 경제적 제약 등이 존재하기 때문에 금융 실무자는 이런 가정이 실제로 위반된다는 것을 알고 모델 또한 비슷하게 비현실적으로 가정, 추후 튜닝
* 과거 자산 가격 보다는 파생상품 가격으로 모델 튜닝이 이루어지며 많이 거래된 옵션의 시장 가격을 수학적 모델로 얻은 파생 상품 가격에 맞추는 것
  -> 모델 튜닝 과정에서 모델의 매개변수를 적합화하기 위해 수천 개의 파생상품 가격을 책정해야하는데, 이 과정에서 많은 시간이 소요되기 때문에 효율적인 수치 계산이 중요
  
1. 문제 정의<br>
    옵션 시장 가격 평가를 위해 선택한 변수는 주가, 행사 가격, 만료기간, 변동성, 이자율, 배당수익으로 사용.<br>
    파생상품 시장에서 중심 역할을 하는 매개변수는 주가 이동과 직결되는 변동성. 주가의 이동범위는 변동성이 증가하면 변동서잉 낮을 때보다 더 넓어짐<br>
    옵션시장에서 모든 옵션의 가격 산정에 사용되는 단 하나의 변동성은 없다 -> 변동성은 옵션 가격도와 만기일에 좌우(만기일이 커지면 증가하고 옵션가격도가 커지면 증가(미소 혹은 변동성 스큐))
  
2. EDA 진행<br>
    산점도에서 변수 간에 매우 흥미로운 의존성과 관계성이 있음을 볼 수 있음<br>
    옵션 가격도가 증가함에 따라 가격이 상승하며, 가격 대비 만기일을 보면 옵션 가격이 하락. 가격 대비 변동성 차트에서는 변동성에 따라 가격이 상승하지만 옵션 가격이 대부분의 변수와 비선형 관계가 있음을 볼 수 있다 -> 비선형 모델이 더 성능이 좋을것<br>
    변동성과 행사가(기초자산을 매수 또는 매도 할 때의 가격)는 옵션 가격도에서 멀어질수록 변동성이 높아짐<br>


3. 단변량 특성 선택<br>
    옵션 가격에서는 옵션 가격도가 가장 중요하며 그 다음이 변동성과 만기일 -> 세개 모두 모델링에 포함
  
4. 모델 훈련 및 평가<br>
     마찬가지로 8대 2로 세트 구성, k=10으로 K-fold 교차 검증 세팅<br>
     모델은 선형회귀, KNN, 의사결정나무, KVM, 신경망 알고리즘, adaboost, gradientboosting(얘네 둘이가 부스팅 방법), 랜포, extratree(배깅 방법)을 모두를 사용하여 훈련<br>
     -> 트리, 앙상블, 인공 신경망을 포함한 비선형 모델은 선형 모델보다 성능이 훨씬 더 좋았음<br>
     -> 인공신경망은 빠른 테스트와 배포 시간으로 어떤 함수든 모델링할 수 있는 본원적 능력이 있으며 복잡한 파생 상품 가격 책정에도 효과적으로 사용 가능 -> 인공신경망을 선택
  
5. 모델 튜닝 및 모델 확정<br>
    인공신경망의 중간층 노드 수를 결정하는 것은 중요하며 그리드 서치를 통한 하이퍼 파라미터를 원래는 찾아야하지만 문제를 단순화 하기 위해 은닉층 수에 대한 그리드 서치만 진행<br>
    -> 은닉층이 3개, 노드가 각각 20개 30개 20개인 모델이 가장 우수
  
6. 결론<br>
    파생 상품 가격 책정은 비선형 문제. 결과로 알 수 있듯이 비선형 회귀 모델의 성능이 더 좋았음
  
이밖에도 투자자 위험 감수 및 로보 어드바이저 -(> 지도 학습 모델을 사용하여 투자자의 위험 허용 범위를 모델링하고 포트폴리오 관리 자동화 가능), 수익률 곡선 예측 (-> 주가 예측과 유사하지만 고정 수입 시장의 맥락에서 선형 모델과 비선형 모델 또한 비교 가능) 또한 머신러닝을 활용해서 가능








